### 第一章 了解web及网络基础

- TIC/IP协议族
  想这样把与互联网相关连的协议集合起来总称为TCP/IP.TCP/IP协议族按层次分别分为以下4层:应用层,传输层,网络层,数据链路层.

  - 应用层
    TIC/IP协议族内预存了各类通用的应用服务.比如FTP,DNS,HTTP

  - 传输层
    传输层对上层应用层,提供处于网络连接中的两台计算机之间的数据传输.在传输层中有两个性质不同的协议:TCP(传输控制协议)和UDP(用户数据报协议)

  - 网络层
    网络层用来处理网络上流动的数据包.数据包是网络传输的最小数据单位.该曾规定了通过怎样的路径(所谓的传输路线)到达对方计算机,并把数据包传送给对方.  
    与对方计算机之间通过多台计算机或网络设备进行传输时,网络层所起的作用就是在众多的选项内选择一条传输路线.

  - 链路层
    用来处理连接网络的硬件部分,包括控制系统,硬件的设备驱动,网卡,光纤等物理可见部分.硬件上的范畴均在链路层的作用范围内.

**一次web页面发送http请求的过程**  
    1. 作为发送端的客户端在应用层发出一个想看某个web页面的http请求.
    2. 为了传输方便,在传输层(TCP协议)把从应用层处收到的数据(http请求报文)进行分割,并在各个报文上打上标记序号及端口号后转发给网络层
    3. 在网络层(IP协议)增加作为通信目的地的MAC地之后转发给链路层.**至此,发往网络的通信请求就准备齐全**
    4. 接收端的服务器在链路层接收到数据,按序往上层发送,一直到应用层,当传输到应用层,才能算真正接收到由客户端发送过来的http请求.  

  发送端在层与层之间传输数据时,没经过一层时必定会被打上一个该层所属的首部信息.反之,接收端在层与层传输数据时,每经过一层时会把对应的首部消去.

- ip, tcp, dns, http
  - ip:位于网络层.ip协议的作用是把各种数据包传送给对方.其中最终要的条件是ip地址和MAC地址.
  - tcp:位于传输层.tcp协议为了更容易传送大数据才把数据分割,而且tcp协议能够确认数据最终是否送达到对方.
    tcp协议采用三次握手策略: 发送端首先发送一个带有SYN的标志的数据包给对方.接收端收到后,回传一个带有SYN/ACK标志的数据包一试传达确认信息.最后,发送端再回传一个带有ACK标志的数据包,代表握手结束.若在握手过程中,某个阶段莫名中断,tcp协议会再次以相同的顺序发送相同的数据包.

    字节流服务是指,为了方便传输,将大块数据分割成报文段为单位的数据包进行管理.
  - dns:位于应用层.提供域名到ip地址之间的解析服务.
  - http协议: 位于应用层.
    - 发送端:生成针对目标web服务器的http请求报文
    - 接收端:对请求内容进行处理
- URI格式(p27有)

### 第二章 简单的http协议

- 请求报文的构成
  方法,uri,协议版本,请求首部字段,内容实体
- 相应报文构成
  协议版本,状态码,状态码的原因短语,相应首部字段,主体
- http协议不保存状态,所以诞生了cookie
- http/1.1中可以使用的方法
  GET:获取资源
  POST:传输实体主体
  PUT:传输文件
  HEAD:获取报文首部
  DELETE:删除文件
  OPTIONS: 询问支持的方法
  TRACE:追踪路径
  CONNECT:要求用隧道协议(SSL,TSL)连接代理
- TCP持久连接
  只要任意一端没有明确提出断开连接,则保持TCP连接状态.在http/1.1中,所有的连接默认都是持久连接.
- 管线化技术允许同时并行发送多个请求.
- cookie技术
  cookie技术通过在请求和相应报文中写入cookie信息来控制客户端的状态.
  **Cookie会根据从服务器端发送的相应报文内的一个叫做SET-Cookie的首部字段信息,通知客户端保存Cookie.当下次客户端再往该服务器发送请求时,客户端会自动在请求报文中加入Cookie值后发送出去.**
  服务器端发现客户端发送过来的Cookie后,会去检查究竟是从哪一个客户端发来的连接请求,然后对比服务器上的记录,最后得到之前的状态信息.

### 第三章 http报文内的http信息

- http报文
  用于http协议交互的信息被称为http报文.

  http报文大致可分为报文首部和报文主体两部分.两者由**空行(CR+LF)**来划分.通常,并不一定要有报文主体.

  **空行(CR+LF)**:CR(Carriage Return,回车符,16进制)和LF(Line Feed,换行符,16进制)

  **报文首部结构**:
      1. 请求行:包含用于请求的方法,请求url和http版本
      2. 状态行:包含表明相应结果的状态码,原因短语和http版本
      3. 首部字段: 包含表示请求和相应的各种条件和属性的各类首部
      一般有四种: 通用首部,请求首部,相应首部,实体首部
      4. 其他: Cookie等

- 报文vs实体
  - 报文
    是http通信中的基本单位,由8字节组成,通过http通信传输
  - 实体
    作为请求或响应的有效荷载数据被传输,其内容由实体首部和实体主体组成

  http报文的主体用于传输请求或响应的实体主体.通常,报文主体等于实体主体,只有当传输中进行编码操作时,实体主体的内容发生变化,才导致它和报文主体产生差异.

### 第四章 返回结果的http状态码
- 状态码的类别

  |      | 类别       | 原因短语          |
  | ---- | -------- | ------------- |
  | 1xx  | 信息性状态码   | 接收的请求正在处理     |
  | 2xx  | 成功状态码    | 请求正常处理完毕      |
  | 3xx  | 重定向状态码   | 需要进行附加操作以完成请求 |
  | 4xx  | 客户端错误状态码 | 服务器无法处理请求     |
  | 5xx  | 服务器错误状态码 | 服务器处理请求出错是    |

  ​
- 常用的14个状态码
  - 200 ok
    表示从客户端发来的请求在服务器端被正常处理了

  - 204 No Content
    表示服务器接收的请求已成功处理,但在返回的响应报文中不含实体的主体部分,也不允许返回任何实体的主体.返回204响应,浏览器显示的页面不发生更新.

  - 206 Partial Content
    表示客户端进行了范围请求,服务器成功执行了这部分的GET请求,响应报文中包含由Content-Range指定范围的实体内容.

  - 301 Moved Permanently
    表示请求的资源已被分配了新的url,以后应使用资源现在所指的url.

  - 302 Found
    表示请求的资源已经被分配了新的url,希望用户本次能使用新的uri访问.和301状态码相似,但302状态码代表的资源不是被永久移动,只是临时性质的.

  - 303 See Other
    表示由于请求对应的资源存在着另一个url,应使用GET方法定向获取请求的资源,**明确表示!!!**

  - 304 Not Modified
    表示客户端发送附带条件的请求时,服务器端允许请求访问资源,但未满足条件的情况.304状态码返回的时候,不包含任何响应的主体部分.304虽然被划分在3xx类别中,但是和重定向没有任何关系.

    *附带条件:指的是采用GET方法的请求报文中包含if-Match, if-Modified-Since, if-None-Match, If-Range, If-Unmodified-Since中任一首部.*
  
  - 307 Temporary Redirect
    临时重定向
  
  - 400 Bad Request
    表示请求报文中存在语法错误.当错误发生时,需修改请求的内容后再次发送请求.

  - 401 Unauthorized
    表示发送的请求需要有通过http认证的认证信息,另外,若之前已经行过1次请求,则表示用户认证失败.

  - 403 Forbidden
    表明对请求资源的访问被服务器拒绝了,服务器端没有必要给出拒绝的详细理由,但如果想作说明的话,可以在实体的主体部分对原因进行描述.

  - 404 Not Found
    表明服务器上无法找到请求的资源,除此之外,也可以在服务器端拒绝请求且不想说明理由时使用.

  - 500 Internal Server Error
    表明服务器端在执行请求时发生了错误.也有可能是web应用存在bug或某些临时的故障.

  - 503 Service Unavailable
    表明服务器暂时处于超负载或正在进行停机维护,现在无法处理请求.
  
  **what?!!!!!!!!状态吗和状况的不一致: 不少返回的状态码响应都是错误的,但是用户可能察觉不到这点.比如web应用程序内部发生错误,状态码依然返回200 ok,这种情况也经常遇到.**

  ### 第五章 与http协作的web服务器

- 用单台虚拟主机实现多个域名

  一台物理机,使用虚拟主机功能,可以看起来有多台服务器.

  **在相同的IP地址下,由于虚拟主机可以寄存多个不同主机名和域名的web网站,因此在发送http请求时,必须在Host首部内完整指定主机名或域名的uri.**

- 通信数据转发程序: 代理,网关,隧道
  - 代理: 代理是一种有转发功能的应用程序,它扮演了位于服务器和客户端之间的中间人的角色,接收由客户端发送的请求并转发给服务器,同时也接收服务器返回的响应并转发给客户端.

    - 源服务器:持有资源实体的服务器
    - 每次通过代理服务器转发请求或响应时,会追加写入Via首部信息
    - 使用代理服务器的理由:
      1. 利用缓存技术减少网络带宽的流量;
      2. 组织内部针对特定网站的访问控制,以获取访问日志为主要目的
    - 代理分类:
      1. 缓存代理: 代理转发响应时,缓存代理会预先将资源的副本缓存在代理服务器上.当代理再次接收到对相同资源的请求时,就可以不从源服务器哪里获取资源,而不是将之前缓存的资源作为响应返回.
      2. 透明代理: 转发请求或响应时,不对报文做任何加工的代理类型被称为透明代理,反之,对报文内容进行加工的代理被成为非透明代理.

  - 网关: 网关是转发其他服务器通信数据的服务器,接受从客户端发送来的请求时,它就像自己拥有资源的源服务器一样对请求进行处理.

    网关的工作机制和代理十分类似,而且网关能使通信线路上的服务器提供非http协议服务(利用网关可以由http请求转化为其他协议通信).

  - 隧道: 隧道是在相隔甚远的客户端和服务器两者之间进行中转,并保持双方通信连接的应用程序.

    隧道可以按要求建立起一条与其他服务器的通信线路,届时使用SSL等加密手段进行通信.隧道的目的是确保客户端能与服务器进行安全的通信.

- 保存资源的缓存

  - 缓存是指代理服务器或客户端本地资源盘内保存的资源副本.利用缓存可以减少对源服务器的访问,因此也就节省了通信流量和通信时间.

  - 缓存的有效期限
    即使存在缓存,也会因为客户端的要求,缓存的有效期等因素,向源服务器确认资源的有效性.若判断缓存失效,缓存服务器将会再次从源服务器上获取新资源.


### 第六章 http首部

- 报文首部: 在客户端和服务器处理时,起至关重要作用的信息几乎都在这里

- 报文主体: 所需要的用户和资源的信息都在这里

- http/1.1首部字段一览: p82

