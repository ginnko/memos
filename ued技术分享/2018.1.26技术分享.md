## kunnka api请求卡顿 长时间无响应故障排查

排查方法:

1. 给kunnka加上内存和cpu监控

   - 全局变量始终被调用
   - 内存泄露导致卡的原因: js单线程,cpu始终处理这个泄露的内存

2. 访问量大

   没有使用cluster模式,每个物理服务器上都是单线程运行

zabbix可以查看cpu使用率

观察发现的结果:1分钟的定时任务到时cpu利用率到100%

对比Pre4和线上环境,发现时验证码和注册功能有端倪

require ccap(库)时 就生成一个实例 默认没1分钟生成20张图存到内存中,实质为内存泄露

**把赋值过程移到创建过程外**



性能工具:easy-monitor



app.use(); 任何api的调用都会执行括号中的内容

----



## 前端开发方式

ambari

替换开发模式

switchyomega

产品与项目>产品列表>[usb1.0](https://confluence.ustack.com/pages/viewpage.action?pageId=17090177)





--by majiajun