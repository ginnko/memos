## 《网络是怎样连接的》读书笔记

### 第一章

#### 学完这章要知道

1. 浏览器如何解析网址
2. 请求消息的格式
3. 浏览器如何向DNS服务器查询域名对应的IP地址
4. DNS服务器是如何相互接力完成IP地址查询的
5. 查询到IP地址之后，浏览器是如何将消息委托给操作系统发欧式那个给web服务器的


#### 浏览器解析网址

1. URL开头的文字，比如`http:`、`ftp:`、`file:`、`mailto`这部分文字表示浏览器应当使用的访问方法。

2. 浏览器解析URL的过程

http协议可以拆成：`协议名`、`//`、`web服务器名`、`表示数据源的路径名`四部分，解析的过程就是捋清一个URL的这四部分。

3. 文件名和目录的省略

`/`表示顶级的根目录，`dir/`表示dir目录

理论上的省略规则：
  
  1. 目录末尾的`/`不应省略

  2. 如果省略一般表示文件名字

4. 解析的目的是要知道访问的目标在哪里，就是知道`web服务器`和`文件名`。

5. 请求消息：方法 + URI（文件路径、程序路径、http开头的URL）+ http版本号

6. HTTP使用的方法

  |方法|含义|
  |---|----|
  |GET|获取URI指定的信息。若URI指定的是文件，则返回文件内容；若指定的是CGI程序，则返回改程序的输出数据|
  |POST|从客户端向服务器发送数据。一般用于发送表单中填写的数据等情况|
  |HEAD|和GET基本相同。不过它只返回HTTP的消息头，并不返回数据的内容，用于获取文件最后更新时间等属性信息|
  |OPTIONS|用于通知或查询通信选项|
  |PUT|替换URI指定的服务器上的文件。如果URI指定的文件不存在，则创建该文件|
  |DELETE|删除URI指定的服务器上的文件|
  |TRACE|将服务器收到的请求行和头部直接返回给客户端。用于在使用代理的环境中检查改写请求的情况|
  |CONNECT|使用代理传输加密消息时使用的方法|
  |||

  - 使用POST方法时，URI会指向web服务器中运行的一个应用程序的文件名（如果用node写的，这个文件名会是xxxxx.js?）

  - 使用GET方法时，当web服务器收到消息后，会打开比如/dir/file.html文件，并读取出里面的数据，然后 **将读出的数据存放到响应消息中**，并返回给客户端。


### http请求消息

请求消息的 **第一行称为请求行**，格式：请求方法[空格]URI[空格]HTTP版本号（最常用的是1.1）。

请求方法是根据浏览器的工作状态确定的。在浏览器地址栏输入网址（使用GET）或是点击网页中的超链接（使用GET）或是点击提交按钮（可能使用GET也可能使用POST），这些都会触发浏览器工作状态的改变。

**第二行开始为消息头**，消息头以一个空行结束。

当网页中包含图片时。会在网页中的相应位置嵌入表示图片文件的标签的控制信息。浏览器会显示文字时搜索相应的标签，当遇到图片相关的标签时，会在屏幕上留出用来显示图片的空间，然后再次访问web服务器，按照标签中指定的文件名向web服务器请求获取相应的图片并显示在预留空间中。

由于每条请求消息中只能写1个URI，所以每次只能获取1个文件，如果需要获取多个文件，必须对每个文件单独发送1条请求。比如1个网页中包含3张图片，那么获取网页加上获取图片，一共需要向web服务器发送4条请求。

### 向DNS服务器查询Web服务器的IP地址

生成HTTP消息之后，下一步就是根据域名查询IP地址。

数据是以包的形式传送的。

1. IP地址分为`网络号`和`主机号`。

IP地址是一串32比特的数字，按照8比特（1字节）为一组分成4组，分别用十进制表示，然后再用圆点隔开。网络号和主机号连起来总共是32比特，但这两部分的具体结构是不固定的。

子网掩码：用来帮助区分ip地址网络号和主机号。其中，子网掩码为1的部分表示网络号，子网掩码为0的部分表示主机号。边界可以划分在句点上，也可以划分在字节上。

比如：

```
10.11.12.13/255.255.255.0

10.11.12.13/24
```

主机号部分的比特全部为零，代表整个子网；主机号部分全部为1代表向子网上所有设备发送包，即广播。

```
10.11.12.0/24  -------------- 表示整个子网

10.11.12.255/24 --------------表示向子网上的所有设备发送包
```

2. **DNS**：Domain Name System。对于DNS服务器，我们的计算机上一定有相应的DNS客户端，相当于DNS客户端的部分称为DNS解析器，或者简称解析器。通过DNS查询IP地址的操作称为域名解析，因此负责执行解析这一操作的就叫解析器了。

解析器是一段程序，包含在操作系统的Socket库中（*Socket库是用于调用网络功能的程序组件集合*）。

当控制流转移到解析器后，解析器会生成要发送给DNS服务器的查询消息。这个过程与浏览器生成要发送给Web服务器的HTTP请求消息的过程类似，但HTTP消息是用文本编写的，DNS消息是用二进制数据编写的。发送消息这个操作并不是由解析器自身来执行，而是要委托给操作系统内部的协议栈来执行。

向DNS服务器发送消息时，我们当然也需要知道DNS服务器的IP地址。只不过这个IP地址是作为TCP/IP的一个设置项目事先设置好的，不需要再去查询了。

3. DNS服务器


